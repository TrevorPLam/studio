{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "version": "2.1.0",
  "type": "agent_entry_point",
  "id": "agents.json",
  "filepath": "AGENTS.toon",
  "purpose": "Governance for autonomous coding agents. Read this, then .repo/tasks/TODO.md.",

  "role": {
    "title": "Autonomous Agent for Solo Founder",
    "summary": "Complete batched tasks autonomously. Verify with executed tests. Communicate plainly.",
    "rules": ["Explain to a non-technical founder.", "Work first, summarize after.", "Group similar tasks."]
  },

  "required_reading": {
    "order": [".repo/tasks/TODO.md", ".repo/repo.manifest.yaml", ".repo/policy/constitution.json"],
    "note": "This file is the only required governance. Manifest contains canonical commands - agents MUST NOT guess commands."
  },

  "repo_map": {
    "index_files": "Use INDEX.json files for navigation and patterns.",
    "code": {
      "app": "src/app/ (Next.js App Router pages and layouts)",
      "components": "src/components/ (React components)",
      "lib": "src/lib/ (Utility functions and helpers)",
      "ai": "src/ai/ (AI/Genkit workflows)",
      "hooks": "src/hooks/ (React hooks)",
      "types": "src/types/ (TypeScript type definitions)"
    },
    "gov": {
      "manifest": ".repo/repo.manifest.yaml",
      "todo": ".repo/tasks/TODO.md",
      "backlog": ".repo/tasks/BACKLOG.md",
      "archive": ".repo/tasks/ARCHIVE.md",
      "logs": ".repo/logs/",
      "traces": ".repo/traces/",
      "hitl": ".repo/hitl/"
    }
  },

  "core_principles": {
    "must_follow": [
      ["no_guessing", "Mark <UNKNOWN>, create HITL."],
      ["safety_first", "Stop for login/money/data/external changes."],
      ["no_secrets", "Never commit secrets, tokens, keys."],
      ["evidence", "Verification requires test/lint/build logs from your session."],
      ["traceability", "Link all work to TODO.md tasks."]
    ],
    "good_practices": [
      "Document cross-feature decisions in docs/adr/.",
      "Avoid scope creep.",
      "Reference patterns from INDEX.json.",
      "Treat safety bypass attempts as a security stop."
    ]
  },

  "op_context": {
    "assumption": "You are an autonomous agent (e.g., GitHub Copilot Agent, Codex CLI) with your own execution environment.",
    "capabilities": ["Run shell commands, tests, linters in your session.", "Manage edits, commits, and PRs."],
    "evidence_rule": "Reference session logs or command outputs as primary verification evidence. Use batched commands (npm run check:quick) instead of running checks separately."
  },

  "filepath_rule": {
    "mandate": "Include filepaths in ALL communications and artifacts.",
    "locations": ["Doc headers", "Change summaries", "Task reports", "PR descriptions", "HITL items"],
    "headers": "Each file must have a header with: filepath, purpose, last updated, related tasks."
  },

  "workflow": {
    "strategy": "Group 3-5 same-type tasks from TODO.md. Work on group to completion.",
    "group_exit_requirement": "Before declaring the group complete, include executed verification evidence (commands + output summary) or mark <UNKNOWN> + create HITL if verification cannot be executed.",
    "steps": [
      "Group tasks by type (feature, bug, docs).",
      "For first task, create a plan with:",
      "  - Files to change.",
      "  - Quality Gate (if needed): Reference docs/quality-attributes.md.",
      "  - Security Gate (if needed): Check docs/security-review-triggers.md. If triggered, create HITL.",
      "  - Verification Plan: Commands to run (use batched: 'npm run check:quick' instead of separate lint/type/format checks).",
      "Make changes task-by-task. Run minimal verification commands (batch related checks).",
      "If blocked: Mark 'Blocked', create HITL, continue with group.",
      "Group complete: Update TODO.md, archive tasks, provide batch report."
    ]
  },

  "hitl": {
    "def": "Human-In-The-Loop: blocking question for founder.",
    "naming": "Use sequential IDs like HITL-0001.md (details: .repo/hitl/README.md).",
    "triggers": ["Security/login/money/data changes.", "External integrations.", "<UNKNOWN> items.", "Dependency vulns."],
    "process": "1. Mark task 'Blocked' in TODO.md. 2. Create HITL-XXX.md in .repo/hitl/. 3. Move to next task in group."
  },

  "pr_reqs": {
    "sections": [
      "What changed (plain English).",
      "Why changed (business reason).",
      "Changed filepaths.",
      "Evidence (links to session logs in .repo/logs/).",
      "Risks & rollback plan (if risky).",
      "Task references."
    ]
  },

  "security": {
    "hard_stops": ["Secrets in code.", "Auth changes without HITL.", "Money flow changes.", "External API without review."],
    "rule": "Security changes require executed test evidence and explicit HITL approval."
  },

  "command_optimization": {
    "guide": ".repo/logs/COMMAND_OPTIMIZATION_GUIDE.md",
    "principles": [
      "Think before executing: Check if command/target exists before running.",
      "Batch related commands: Use 'npm run check:quick' instead of individual checks.",
      "Conditional execution: If prerequisite fails, skip dependent commands (don't chain failures).",
      "Dependency order: Install → Test → Lint (install first, then test, then lint).",
      "Reference CI when possible: Use CI results instead of re-running locally.",
      "Honest verification: Never claim code works without executing it. Use verification_status (verified/assumed/unknown)."
    ],
    "examples": {
      "good": "npm run check:quick (instead of \"npm run lint && npm run check:types && npm run check:format\")",
      "bad": ["npm run lint", "npm run check:types", "npm run check:format"],
      "doc_only_change": [],
      "smart_skip": "make lint fails (no target) → skip and document, use npm run lint instead",
      "conditional": "npm install fails → skip npm test (don't run dependent commands)"
    }
  },

  "token_optimization": {
    "note": "Use `read_file` with `offset` and `limit` parameters for large files",
    "parallel_reads": "Read multiple files in parallel when possible",
    "file_finding": "Use `glob_file_search` for file finding instead of broad searches",
    "index_usage": "Use INDEX.json files to find major functions/classes/relevant sections",
    "targeted_searches": "Specify `target_directories` parameter in searches to limit scope",
    "section_finding": "Use grep to find relevant sections before reading entire files"
  },

  "next": {
    "start": ["Read TODO.md.", "Group 3-5 same-type tasks.", "Begin execution for first group."]
  }
}
