{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "version": "1.0.0",
  "type": "agent_entry_point",
  "role": "AI coding agent operating in a governed repository. Complete tasks safely, following all rules and workflows.",
  "purpose": "Tight, organized governance framework for AI agents",

  "token_optimization": {
    "note": "Use `read_file` with `offset` and `limit` parameters for large files",
    "parallel": "Read multiple files in parallel when possible",
    "file_finding": "Use `glob_file_search` for file finding instead of broad searches",
    "index_usage": "Use INDEX.json files to find major functions/classes/relevant sections",
    "targeted_searches": "Specify `target_directories` parameter in searches to limit scope",
    "section_finding": "Use grep to find relevant sections before reading entire files"
  },
  "directory_structure": {
    "core_files": {
      "AGENTS.md": "Agent entry point - read this first",
      "repo.manifest.yaml": "Source of truth for commands",
      "policy/constitution.json": "Behavioral rules (what to do)",
      "policy/procedures.json": "Procedural instructions (how to do it)"
    },
    "task_management": {
      "tasks/TODO.md": "Active tasks (3-5 at a time, grouped by type)",
      "tasks/BACKLOG.md": "Prioritized queue (P0 → P3)",
      "tasks/ARCHIVE.md": "Completed tasks",
      "tasks/packets/": "Task packets (feature/api_change/cross_module)",
      "tasks/README.md": "Task management workflow"
    },
    "templates": {
      "templates/PR_TEMPLATE.md": "PR description template",
      "templates/ADR_TEMPLATE.md": "Architecture Decision Record template",
      "templates/WAIVER_TEMPLATE.md": "Policy waiver template",
      "templates/AGENT_LOG_TEMPLATE.md": "Agent log template",
      "templates/AGENT_TRACE_SCHEMA.json": "Trace log JSON schema",
      "templates/AGENT_CONTEXT_SCHEMA.json": ".agent-context.json schema",
      "templates/EVIDENCE_SCHEMA.json": "Evidence validation schema",
      "templates/examples/": "Example files (task packets, tests, trace logs)"
    },
    "agent_framework": {
      "agents/pr-review.md": "PR review checklist",
      "agents/task_packet.md": "Task packet prompt template"
    },
    "automation": {
      "automation/README.md": "Automation overview",
      "scripts/governance-verify.js": "Governance verification (used in CI)",
      "scripts/check-boundaries.js": "Boundary checker (used by agent)",
      "scripts/check-changelog-and-logs.js": "Pre-commit hook (hard block)",
      "scripts/promote-task.py": "Task promotion",
      "scripts/archive-task.py": "Task archiving"
    },
    "artifacts": {
      "hitl/": "HITL items (HITL-XXXX.md)",
      "logs/": "Agent logs (TASK-XXX-log-*.json)",
      "traces/": "Trace logs (TASK-XXX-trace-*.json)"
    }
  },

  "command_routing": {
    "Start": "follow_workflow",
    "Work": "follow_workflow",
    "Task": "follow_workflow",
    "Review": "skip_to_pr_section",
    "Security": ["read_security_baseline", "then_follow_workflow"],
    "Help": "show_help_section"
  },

  "required_reading": {
    "order": [
      ".repo/tasks/TODO.md",
      ".repo/repo.manifest.yaml",
      ".repo/policy/constitution.json"
    ],
    "alternatives": {
      "procedures": ".repo/policy/procedures.json"
    }
  },

  "context_determination": {
    "security": {
      "triggers": ["auth", "money", "external_systems", "payment_flows"],
      "action": [
        "read",
        ".repo/policy/constitution.json (security section)",
        "create_hitl",
        "stop_work"
      ]
    },
    "boundaries": {
      "triggers": ["cross_module_imports"],
      "action": [
        "read",
        ".repo/policy/constitution.json (boundaries section)",
        "create_adr"
      ]
    },
    "backend_frontend": {
      "triggers": ["backend_code", "frontend_code"],
      "action": [
        "read",
        ".repo/policy/constitution.json (best_practices section)",
        "read_folder_guide",
        "read_agent_context_json"
      ]
    },
    "folder_entry": {
      "triggers": ["entering_folder"],
      "action": ["read", ".agent-context.json", "read", ".AGENT.md"]
    },
    "unknown": {
      "triggers": ["not_in_docs", "not_in_manifest", "not_in_code"],
      "action": [
        "mark_unknown",
        "read",
        ".repo/policy/procedures.json (hitl section)",
        "create_hitl",
        "stop_work"
      ]
    }
  },

  "workflow": {
    "three_pass": {
      "pass0_context": {
        "name": "Context",
        "steps": [
          "read_folder_context_files",
          "read_agent_context_json_when_entering_folder"
        ],
        "description": "Read folder-level context files (.agent-context.json, .AGENT.md) when entering a folder"
      },
      "pass1_plan": {
        "steps": [
          "determine_change_type",
          "list_all_actions",
          "identify_risks",
          "list_all_files_to_modify",
          "mark_unknown_items",
          "check_hitl_needed",
          "create_task_packet_if_required"
        ],
        "output": "plan_with_actions_risks_files_unknowns_hitl",
        "blockers": {
          "hitl": ["create_hitl", "stop_work", "wait_completion"],
          "adr": ["create_adr", "document_decision"]
        }
      },
      "pass2_change": {
        "steps": [
          "apply_edits_from_plan",
          "follow_existing_patterns",
          "include_filepaths_global_rule",
          "respect_boundaries"
        ],
        "output": "code_changes_with_filepaths",
        "do_not_proceed_if": [
          "pass1_blockers_exist",
          "unknown_items_unresolved",
          "security_risky_without_hitl_approval"
        ]
      },
      "pass3_verify": {
        "steps": [
          "run_tests_from_manifest",
          "provide_evidence",
          "update_logs",
          "check_quality_gates",
          "document_in_pr"
        ],
        "output": "evidence_updated_logs_passing_tests"
      }
    }
  },

  "task_completion": {
    "steps": [
      "mark_acceptance_criteria_complete",
      "add_completion_date",
      "move_to_archive",
      "promote_next_task"
    ],
    "files": {
      "todo": ".repo/tasks/TODO.md",
      "archive": ".repo/tasks/ARCHIVE.md",
      "backlog": ".repo/tasks/BACKLOG.md"
    }
  },

  "pr_creation": {
    "required_reading": [
      ".repo/agents/pr-review.md",
      ".repo/templates/PR_TEMPLATE.md",
      ".repo/policy/constitution.json (quality_gates section)",
      ".repo/policy/procedures.json (hitl section)"
    ],
    "required_sections": [
      "what_changed",
      "why_changed",
      "filepaths_all_files",
      "verification_evidence",
      "risks_if_any",
      "rollback_if_risky"
    ]
  },

  "rules": {
    "always": [
      "include_filepaths_in_all_changes",
      "link_changes_to_task_in_todo",
      "mark_unknown_create_hitl",
      "show_verification_evidence"
    ],
    "never": [
      "guess_commands_use_manifest_or_hitl",
      "skip_filepaths_required_everywhere",
      "commit_secrets_or_env_files",
      "cross_boundaries_without_adr",
      "proceed_with_unknown_items",
      "make_risky_changes_without_hitl"
    ]
  },

  "decision_trees": {
    "hitl_needed": {
      "risky": {
        "triggers": ["security", "money", "production", "external"],
        "action": "create_hitl_stop"
      },
      "unknown": {
        "triggers": ["not_in_docs", "not_in_manifest", "not_in_code"],
        "action": "mark_unknown_create_hitl_stop"
      },
      "cross_boundaries": {
        "triggers": true,
        "action": "requires_adr"
      }
    }
  },

  "troubleshooting": {
    "todo_empty": ["check_backlog", "promote_highest_priority_task"],
    "manifest_missing": ["mark_unknown", "create_hitl", "stop_work"],
    "constitution_json_missing": ["read_procedures_json", "or_check_archive"]
  },

  "next_steps": {
    "after_reading_this": [
      "read_agents_tasks_todo_md",
      "read_repo_manifest_yaml",
      "read_policy_constitution_json",
      "follow_three_pass_workflow"
    ]
  },

  "agent_workflow": {
    "step1": "Read .repo/AGENTS.md → .repo/tasks/TODO.md → .repo/repo.manifest.yaml → .repo/policy/constitution.json",
    "step2": "Follow three-pass workflow from this file",
    "step3": "Reference .repo/policy/procedures.json for how-to instructions",
    "step4": "Use templates from .repo/templates/ when creating artifacts",
    "step5": "Create logs in .repo/logs/ and .repo/traces/ for non-doc changes"
  },

  "file_count": {
    "core_files": 4,
    "task_files": 4,
    "templates": "8 active templates + 10 examples",
    "scripts": 28,
    "total": "~60 files (down from ~100+ before cleanup)"
  },

  "note": "This is a single-agent system. You are the only agent working on tasks."
}
