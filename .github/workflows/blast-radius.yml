name: Blast Radius

on:
  pull_request:
    branches: [main, develop]

jobs:
  blast-radius:
    name: Check Protected Paths
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Check blast radius
        run: ./scripts/security/check-blast-radius.sh
        env:
          GITHUB_BASE_REF: ${{ github.base_ref }}
      
      - name: Check for approval label
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            const labels = context.payload.pull_request.labels.map(l => l.name);
            if (labels.includes('protected-paths-approved')) {
              console.log('Protected paths approved by label');
              process.exit(0);
            } else {
              core.setFailed('Protected paths changed without approval');
            }
